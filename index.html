<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>稻香村发展计划 - 武侠像素大战略</title>
    <link rel="stylesheet" href="./src/style.css">
</head>
<body oncontextmenu="return false;">
    <div id="app">
        <!-- 全局通知容器 -->
        <div id="notification-container"></div>

        <!-- UI 层：主菜单、UI面板等 -->
        <div id="ui-layer">
            <div id="menu-background" class="menu-bg"></div>
            <!-- 主菜单 -->
            <div id="main-menu" class="menu-container">
                <div class="menu-decoration-top"></div>
                <h1 class="game-title">稻香村<span>发展计划</span></h1>
                <div class="menu-options">
                    <button id="start-btn" class="wuxia-btn">闯荡江湖</button>
                    <button id="how-to-play-btn" class="wuxia-btn">江湖指南</button>
                    <button id="open-skill-learn-btn" class="wuxia-btn">招式图谱</button>
                    <button id="exit-btn" class="wuxia-btn">退出游戏</button>
                </div>
                <div class="menu-decoration-bottom"></div>
            </div>

            <!-- 大世界 HUD (简化后的资源显示) -->
            <div id="world-ui" class="hidden">
                <div class="resource-bar" style="top: 15px; left: 10px;">
                    <div class="res-item"><span class="res-emoji">💰</span><span id="world-gold">1000</span></div>
                    <div class="res-item"><span class="res-emoji">🪵</span><span id="world-wood">200</span></div>
                </div>

                <!-- 大世界 HUD：左下角状态区 -->
                <div class="hud-bottom-left" id="world-hud-bottom-left">
                    <!-- 城池卡片：大尺寸 -->
                    <div class="hud-card hud-card-city" id="city-mini-card">
                        <div class="hud-portrait" id="world-city-portrait"></div>
                        <div class="hud-info">
                            <span class="hud-name" id="world-city-display-name">稻香村</span>
                            <span class="hud-sub">当前主城</span>
                        </div>
                    </div>

                    <!-- 英雄卡片：小尺寸，靠右排列 -->
                    <div class="hud-card hud-card-hero" id="hero-mini-card">
                        <div class="hud-portrait" id="world-hero-portrait"></div>
                        <div class="hud-info">
                            <div class="hud-mini-bars">
                                <div class="mini-bar-bg"><div id="hud-hero-hp-bar" class="mini-bar-fill hp"></div></div>
                                <div class="mini-bar-bg"><div id="hud-hero-mp-bar" class="mini-bar-fill mp"></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 侠客属性面板 V4 紧凑版 -->
                <div id="hero-stats-panel" class="menu-container hidden hero-panel-v4">
                    <div class="hero-panel-header">
                        <div class="header-ornament-left"></div>
                        <div class="panel-title">侠客名鉴</div>
                        <div class="header-ornament-right"></div>
                        <button id="close-hero-panel" class="close-btn-v3">×</button>
                    </div>
                    
                    <div class="hero-panel-main">
                        <!-- 上部分：核心信息与进度条 -->
                        <div class="hero-core-info">
                            <div class="hero-avatar-area">
                                <div class="hero-big-portrait" id="hero-panel-portrait"></div>
                                <div class="hero-identity">
                                    <h2 id="hero-panel-name">祁进</h2>
                                    <p id="hero-panel-title" class="char-title">紫虚子</p>
                                    <div class="hero-level-tag">等级 <span id="hero-level-val">1</span></div>
                                </div>
                            </div>
                            
                            <div class="hero-bars-area">
                                <div class="stat-group-v3">
                                    <div class="bar-label">气血 (HP)</div>
                                    <div class="stat-bar-container">
                                        <div class="stat-bar-bg"><div id="hero-hp-bar" class="stat-bar-fill hp"></div></div>
                                        <span id="hero-hp-text" class="stat-value">500/500</span>
                                    </div>
                                </div>
                                <div class="stat-group-v3">
                                    <div class="bar-label">内力 (MP)</div>
                                    <div class="stat-bar-container">
                                        <div class="stat-bar-bg"><div id="hero-mp-bar" class="stat-bar-fill mp"></div></div>
                                        <span id="hero-mp-text" class="stat-value">100/100</span>
                                    </div>
                                </div>
                                <div class="stat-group-v3">
                                    <div class="bar-label">阅历 (XP)</div>
                                    <div class="stat-bar-container">
                                        <div class="stat-bar-bg"><div id="hero-xp-bar" class="stat-bar-fill xp"></div></div>
                                        <span id="hero-xp-text" class="stat-value">0/100</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 中部分：详细属性矩阵 -->
                        <div class="hero-attributes-section">
                            <div class="attributes-header">
                                <span>—— 基础潜能 ——</span>
                            </div>
                            <div class="attributes-grid-v4">
                                <div class="attr-box highlighted" id="attr-box-morale">
                                    <div class="attr-label">军队</div>
                                    <div class="attr-val" id="attr-morale">40</div>
                                </div>
                                <div class="attr-box highlighted" id="attr-box-leadership">
                                    <div class="attr-label">统御</div>
                                    <div class="attr-val" id="attr-leadership-max">20</div>
                                </div>
                                <div class="attr-box highlighted" id="attr-box-power">
                                    <div class="attr-label" id="attr-power-label">力道</div>
                                    <div class="attr-val" id="attr-primary-val">50</div>
                                </div>
                                <div class="attr-box highlighted" id="attr-box-spells">
                                    <div class="attr-label">功法</div>
                                    <div class="attr-val" id="attr-fali">100</div>
                                </div>
                                <div class="attr-box highlighted" id="attr-box-haste">
                                    <div class="attr-label">调息</div>
                                    <div class="attr-val"><span id="attr-haste">10</span>%</div>
                                </div>
                                <div class="attr-box" id="attr-box-speed">
                                    <div class="attr-label">轻功</div>
                                    <div class="attr-val" id="attr-speed">0.08</div>
                                </div>
                            </div>
                        </div>

                        <!-- 下部分：技能展示 -->
                        <div class="hero-skills-section-v4">
                            <div class="section-header-v4">
                                <div class="label-with-icon">習得招式</div>
                            </div>
                            <div id="hero-panel-skills" class="hero-skills-list-v4">
                                <!-- 动态填充技能图标 -->
                            </div>
                        </div>
                    </div>
                    <div class="menu-decoration-bottom"></div>
                </div>

                <div id="town-management-panel" class="menu-container hidden town-panel-v3">
                    <div class="menu-decoration-top"></div>
                    <button id="close-town-panel" class="close-btn-v3" title="关闭">×</button>
                    <div class="town-header-top-v3">
                        <div class="town-income-v3">季度产出: 💰<span id="town-income-gold">1000</span> 🪵<span id="town-income-wood">200</span></div>
                        <h2 id="town-name" class="town-title-v3">稻香村</h2>
                        <div style="flex: 1;"></div> <!-- 占位符确保名称居中 -->
                    </div>
                    
                    <div class="town-main-content">
                        <!-- 左侧：建筑规划 -->
                        <div class="town-construction-section">
                            <div class="construction-container">
                                <div class="construction-category economy">
                                    <div class="cat-label">商业</div>
                                    <div id="build-cat-economy" class="building-grid"></div>
                                </div>
                                <div class="construction-category military">
                                    <div class="cat-label">军事</div>
                                    <div id="build-cat-military" class="building-grid"></div>
                                </div>
                                <div class="construction-category magic">
                                    <div class="cat-label">特殊</div>
                                    <div id="build-cat-magic" class="building-grid"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 右侧：招募面板 -->
                        <div class="town-recruit-section">
                            <div id="town-recruit-list" class="recruit-list-v3"></div>
                        </div>
                    </div>

                    <!-- 底部：调兵遣将区域 -->
                    <div class="town-army-section">
                        <div class="army-container garrison">
                            <div class="army-label">驻守兵力</div>
                            <div id="town-units-list" class="army-slots-v3"></div>
                        </div>
                        <div class="army-transfer-actions">
                            <button id="collect-all-btn" class="transfer-btn" title="全部领取至队伍">▶</button>
                            <button id="deposit-all-btn" class="transfer-btn" title="队伍全部驻守">◀</button>
                        </div>
                        <div class="army-container hero-army">
                            <div class="army-label">我的队伍</div>
                            <div id="hero-army-list" class="army-slots-v3"></div>
                        </div>
                    </div>

                    <div class="menu-decoration-bottom"></div>
                </div>

                <div class="world-date-display-container">
                    <div class="time-progress-outer">
                        <div class="time-progress-circle"></div>
                    </div>
                    <div class="world-date-display">天宝 三年 · 春</div>
                </div>
            </div>

            <!-- 招式学习面板 (独立于属性面板，确保居中) -->
            <div id="skill-learn-panel" class="hidden skill-learn-v3">
                <div class="menu-decoration-top">招式图谱</div>
                <button id="close-skill-learn" class="close-btn-v3">×</button>
                <div class="skill-learn-content">
                    <div class="skill-learn-header-row">
                        <div class="skill-learn-tabs">
                            <button class="tab-btn active" data-sect="chunyang">纯阳招式</button>
                            <button class="tab-btn" data-sect="tiance">天策招式</button>
                            <button class="tab-btn" data-sect="cangjian">藏剑招式</button>
                        </div>
                    </div>
                    <div id="skill-list-to-learn" class="skill-grid-v3">
                        <!-- 动态生成待学习技能 -->
                    </div>
                </div>
                <div class="menu-decoration-bottom"></div>
            </div>

            <!-- 江湖指南面板 -->
            <div id="how-to-play-panel" class="hidden skill-learn-v3">
                <div class="menu-decoration-top">江湖指南</div>
                <button id="close-how-to-play" class="close-btn-v3">×</button>
                <div class="how-to-play-content">
                    <div id="how-to-play-text" class="how-to-play-scroll">
                        <!-- 动态生成指南内容 -->
                    </div>
                </div>
                <div class="menu-decoration-bottom"></div>
            </div>

            <!-- 角色选择界面 -->
            <div id="character-select" class="menu-container hidden">
                <div class="menu-decoration-top"></div>
                <h2 class="game-title select-title">选择<span>你的侠客</span></h2>
                <div class="character-cards">
                    <div class="char-card" data-hero="qijin">
                        <div class="char-portrait qijin-portrait"></div>
                        <h3 class="char-name">祁进</h3>
                        <p class="char-title">紫虚子</p>
                        <div class="char-traits">
                            <div class="trait">
                                <span class="trait-tag">门派领袖</span>
                                <span class="trait-desc">纯阳弟子血量和伤害提高 20%</span>
                            </div>
                        </div>
                    </div>
                    <div class="char-card" data-hero="lichengen">
                        <div class="char-portrait lichengen-portrait"></div>
                        <h3 class="char-name">李承恩</h3>
                        <p class="char-title">天策府统领</p>
                        <div class="char-traits">
                            <div class="trait">
                                <span class="trait-tag">骁勇善战</span>
                                <span class="trait-desc">大世界移动速度提高 20%，天策兵种血量提高 10%</span>
                            </div>
                        </div>
                    </div>
                    <div class="char-card" data-hero="yeying">
                        <div class="char-portrait yeying-portrait"></div>
                        <h3 class="char-name">叶英</h3>
                        <p class="char-title">藏剑大庄主</p>
                        <div class="char-traits">
                            <div class="trait">
                                <span class="trait-tag">心剑合一</span>
                                <span class="trait-desc">藏剑弟子攻击频率提高 20%</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="menu-options">
                    <button id="confirm-char-btn" class="wuxia-btn disabled" disabled>开启江湖</button>
                    <button id="back-to-menu-btn" class="wuxia-btn small-btn">返回主页</button>
                </div>
                <div class="menu-decoration-bottom"></div>
            </div>

            <!-- 部署界面 -->
            <div id="deployment-ui" class="deployment-container hidden">
                <div class="deploy-info">请派遣你的侠客 (点击图标后点击地面)</div>
                <div class="unit-slots">
                    <div class="unit-slot" data-type="melee">
                        <div class="slot-icon melee-icon"></div>
                        <span class="slot-count">x10</span>
                    </div>
                    <div class="unit-slot" data-type="ranged">
                        <div class="slot-icon ranged-icon"></div>
                        <span class="slot-count">x4</span>
                    </div>
                    <div class="unit-slot" data-type="archer">
                        <div class="slot-icon archer-icon"></div>
                        <span class="slot-count">x2</span>
                    </div>
                    <div class="unit-slot" data-type="healer">
                        <div class="slot-icon healer-icon"></div>
                        <span class="slot-count">x2</span>
                    </div>
                    <div class="unit-slot" data-type="cangjian">
                        <div class="slot-icon cangjian-icon"></div>
                        <span class="slot-count">x2</span>
                    </div>
                    <div class="unit-slot" data-type="tiance">
                        <div class="slot-icon tiance-icon"></div>
                        <span class="slot-count">x1</span>
                    </div>
                    <div class="unit-slot" data-type="chunyang">
                        <div class="slot-icon chunyang-icon"></div>
                        <span class="slot-count">x2</span>
                    </div>
                    <div class="unit-slot" data-type="cangyun">
                        <div class="slot-icon cangyun-icon"></div>
                        <span class="slot-count">x2</span>
                    </div>
                </div>
                <button id="fight-btn" class="wuxia-btn small-btn">开战！</button>
            </div>

            <!-- 战斗技能栏 (战斗开始后显示) -->
            <div id="battle-skill-bar" class="skill-bar-container hidden">
                <div class="battle-mp-status">
                    <div class="mp-bar-bg">
                        <div id="battle-mp-fill" class="mp-bar-fill"></div>
                    </div>
                    <div id="battle-mp-text" class="mp-text">内力: 100/100</div>
                </div>
                
                <!-- 技能类别过滤 -->
                <div id="skill-category-filters" class="skill-category-filters">
                    <button class="filter-btn active" data-category="all">所有</button>
                    <!-- 动态注入门派特定类别 -->
                </div>

                <div class="skill-slots" id="skill-slots">
                    <!-- 动态生成技能按钮 -->
                </div>
            </div>

            <!-- 战斗结算界面 -->
            <div id="battle-settlement" class="menu-container hidden">
                <div class="menu-decoration-top">战斗统计</div>
                <h2 id="settlement-title" class="game-title">战斗胜利</h2>
                <div class="settlement-content">
                    <div class="loss-section">
                        <div class="section-label">我方损失兵力</div>
                        <div id="settlement-losses-list" class="loss-list">
                            <!-- 动态填充 -->
                        </div>
                    </div>
                </div>
                <div class="menu-options">
                    <button id="return-to-world-btn" class="wuxia-btn">返回大世界</button>
                </div>
                <div class="menu-decoration-bottom"></div>
            </div>

            <!-- 开局提示窗口 -->
            <div id="game-start-window" class="menu-container hidden">
                <div class="menu-decoration-top">江湖告示</div>
                <h2 class="game-title">初入<span>江湖</span></h2>
                <div class="game-start-content">
                    <p class="game-start-intro">请你发展稻香村，扩大势力，成就一番霸业。</p>
                    <div class="enemy-info-box">
                        <div class="enemy-info-label">本场对手</div>
                        <div id="game-start-enemies" class="enemy-list-horizontal">
                            <!-- 动态填充对手信息 -->
                        </div>
                    </div>
                </div>
                <div class="menu-options">
                    <button id="close-game-start-btn" class="wuxia-btn">踏上征途</button>
                </div>
                <div class="menu-decoration-bottom"></div>
            </div>

            <!-- 全局提示框 (Tooltip) -->
            <div id="game-tooltip" class="tooltip-container hidden">
                <div class="tooltip-title"></div>
                <div class="tooltip-level"></div>
                <div class="tooltip-effect"></div>
                <div class="tooltip-desc"></div>
            </div>

            <!-- 暂停菜单 -->
            <div id="pause-menu" class="menu-overlay hidden">
                <div class="menu-container pause-container" id="pause-main-content">
                    <div class="menu-decoration-top">江湖休整</div>
                    <h2 class="game-title">中途<span>休息</span></h2>
                    <div class="menu-options" id="pause-default-options">
                        <button id="resume-game-btn" class="wuxia-btn">继续江湖</button>
                        <button id="open-settings-btn" class="wuxia-btn">江湖设置</button>
                        <button id="back-to-menu-from-pause-btn" class="wuxia-btn small-btn">退出到主界面</button>
                    </div>

                    <!-- 设置面板 (在暂停菜单内切换) -->
                    <div id="pause-settings-options" class="hidden">
                        <div class="settings-group">
                            <label>音乐音量</label>
                            <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.5">
                        </div>
                        <div class="settings-group">
                            <label>音效音量</label>
                            <input type="range" id="sfx-volume-slider" min="0" max="1" step="0.01" value="1.0">
                        </div>
                        <button id="close-settings-btn" class="wuxia-btn small-btn" style="margin-top: 20px;">返回暂停</button>
                    </div>
                    <div class="menu-decoration-bottom"></div>
                </div>
            </div>
        </div>
        
        <!-- Canvas 层：Three.js 渲染 -->
        <canvas id="game-canvas"></canvas>
    </div>
    <script type="module" src="/src/main.js"></script>
</body>
</html>



